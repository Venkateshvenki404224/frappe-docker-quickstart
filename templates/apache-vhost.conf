# Apache VirtualHost Template for Frappe
# Replace variables: {SUBDOMAIN}, {DOMAIN}, {SERVER_IP}, {PORT}

<VirtualHost *:80>
    ServerName {SUBDOMAIN}.{DOMAIN}

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/{SUBDOMAIN}_error.log
    CustomLog ${APACHE_LOG_DIR}/{SUBDOMAIN}_access.log combined

    # Proxy settings
    ProxyRequests Off
    ProxyPreserveHost On
    ProxyTimeout 300

    # WebSocket support
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) "ws://{SERVER_IP}:{PORT}/$1" [P,L]

    # HTTP proxy
    ProxyPass / http://{SERVER_IP}:{PORT}/
    ProxyPassReverse / http://{SERVER_IP}:{PORT}/

    # Headers
    RequestHeader set X-Forwarded-Proto "http"
    RequestHeader set X-Forwarded-Host "{SUBDOMAIN}.{DOMAIN}"
    RequestHeader set X-Real-IP %{REMOTE_ADDR}s
</VirtualHost>
